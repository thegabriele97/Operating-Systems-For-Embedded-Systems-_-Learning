/* ERIKA Enterprise. */
#include "ee.h"

/* Arduino SDK. */
#include "Arduino.h"
#include "HelpfulSerial.h"
#include "MyArduino.h"
#include "stdio.h"

extern HelpfulSerial *serial;
char buff[BUFSIZ];

TASK(Task0) {
	serial->formatted_println(__FILE__, "Task0", "has been started");

	TerminateTask();
};

TASK(Task1) {

	serial->println("task.cpp: Task1 has been started!");

	while(WaitEvent(0x1) == E_OK) {
		ClearEvent(0x1);

		GetResource(RES_PORTD_REG);
		PORTD ^= MASK(3);

		sprintf(buff, "task.cpp: Task1: DDRD=[0x%x]\tPORTD=[0x%x]", DDRD, PORTD);
		serial->println(buff);

		ReleaseResource(RES_PORTD_REG);
	}

	serial->println("task.cpp: Task1: closing...!");
	TerminateTask();
};

TASK(Task2) {

	serial->println("task.cpp: Task2 has been started!");

	while(WaitEvent(0x1) == E_OK) {
		ClearEvent(0x1);

		GetResource(RES_PORTD_REG);
		PORTD ^= MASK(7);

		sprintf(buff, "task.cpp: Task2: DDRD=[0x%x]\tPORTD=[0x%x]", DDRD, PORTD);
		serial->println(buff);

		ReleaseResource(RES_PORTD_REG);
	}

	serial->println("task.cpp: Task2: closing...!");
	TerminateTask();
};
