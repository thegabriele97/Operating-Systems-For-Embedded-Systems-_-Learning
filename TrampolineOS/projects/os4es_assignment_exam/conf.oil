OIL_VERSION = "2.5" : "test" ;

CPU test {    
	OS config {
		STATUS = STANDARD;
		BUILD = TRUE {
			TRAMPOLINE_BASE_PATH = "../../trampoline";
			APP_NAME = "MorseTwitter";
			APP_SRC = "code.cpp";
			APP_SRC = "task.cpp";
			APP_SRC = "comm_fnct.cpp";
			APP_SRC = "callback.cpp";
			CPPCOMPILER = "avr-g++";
			COMPILER = "avr-gcc";
			LINKER = "avr-gcc";
			ASSEMBLER = "avr-gcc";
			COPIER = "avr-objcopy";
			SYSTEM = PYTHON;

			// CFLAGS = "-D DEBUG"; // Uncomment this line if you want to read debug info from serial port

			LIBRARY = serial;
		};

		SYSTEM_CALL = TRUE;
	};

  	APPMODE stdAppmode {};

	EVENT EVTBitTiming {
		MASK = 0x01;
	};

	EVENT EVTMsgSendCompleted {
		MASK = 0x04;
	};

	EVENT EVTMsgPause {
		MASK = 0x02;
	};

	TASK TaskTwitterer {
		PRIORITY = 0x1;
	    AUTOSTART = TRUE {
			APPMODE = stdAppmode;
		};
		SCHEDULE = FULL;
		ACTIVATION = 1;
		STACKSIZE = 96;
		EVENT = EVTMsgPause;
		EVENT = EVTMsgSendCompleted;
	};

	TASK TaskSender {
		PRIORITY = 0x2;
	    AUTOSTART = FALSE;
		SCHEDULE = NON;
		ACTIVATION = 1;
		STACKSIZE = 96;
		EVENT = EVTBitTiming;
		EVENT = EVTMsgSendCompleted;
	};

	COUNTER SystemCounter {
		MINCYCLE = 1;
		MAXALLOWEDVALUE = 0xffffff;
		TICKSPERBASE = 6250; // every 6250 ticks, we have the counter that goes up by 1. Means every 100 ms
		//TICKSPERBASE = 1;
	};

	COUNTER GoodCounter {
		SOURCE = TIMER0_OVF;
		MINCYCLE = 1;
		MAXALLOWEDVALUE = 0xffffff;
		TICKSPERBASE = 1; // every 6250 ticks, we have the counter that goes up by 1. Means every 100 ms
	};
	
	ALARM ALARMBitTiming {
		COUNTER = GoodCounter;
		AUTOSTART = FALSE;
		ACTION = SETEVENT {
			TASK = TaskSender;
			EVENT = EVTBitTiming;
		};
	};

	ALARM ALARMMsgPause {
		COUNTER = SystemCounter;
		AUTOSTART = FALSE;
		ACTION = SETEVENT {
			TASK = TaskTwitterer;
			EVENT = EVTMsgPause;
		};
	};

	ALARM ALARMStopDisplay {
		COUNTER = SystemCounter;
		AUTOSTART = FALSE;
		ACTION = ALARMCALLBACK {
    		ALARMCALLBACKNAME = "ALARMStopDisplay";
  		};
	};

};
